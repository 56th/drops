#=============================================================
#    DROPS parameter file for twophasedrops
#    simulation of two-phase flow:
#    droplet in measuring cell used in NMR measurements
#=============================================================

# time stepping
Time {
    NumSteps      = 10000     # number of timesteps
    StepSize      = 2e-4      # time step size
    Scheme        = 1         # time integration scheme, see mzelle_hdr.h::CreateTimeDisc(...) for details
}

# flow solver
Stokes {
    StokesMethod  = 10102     # see num/stokessolverfactory.h for details
    InnerIter     = 1000      # max number of iterations of the inner solver
    OuterIter     = 200       # max number of iterations of the outer solver
    InnerTol      = 0.6       # inner reduction/tolerance for InexactUzawa
    OuterTol      = 1e-10     # stopping criterion for the outer iteration
    PcAIter       = 2         # V-cycles multigrid, iter pc for A block
    PcATol        = 1e-99     # abs. resid for multigrid, otherwise rel. resid
    PcSTol        = 1e-4      # resid for schur complememt preconditioner
    XFEMStab      = 0.1       # threshold for discarding ext. dofs parameter, default 0.1
    Theta         = 1         # 0=FwdEuler, 1=BwdEuler, 0.5=CrankNicholson
}

NavStokes {
    Nonlinear     = 1         # magnitude of nonlinear term, 1 = Navier Stokes; 0 = Stokes
    Tol           = 5e-10     # tolerance of the Navier-Stokes-solver
    Iter          = 20        # maximal number of iterations of the solver
    Reduction     = 0.1       # the Oseen-residual is reduced by this factor (<1.0)
}

# levelset solver
Levelset {
    Tol           = 1e-14     # tolerance for Level Set solver
    Iter          = 500       # max. number of iterations for Level Set solver
    SD            = 0.1       # streamline diffusion parameter
    CurvDiff      = -1        # smoothing of Level Set function before curvature term discretization
    VolCorrection = 1         # volume correction every n steps
    Theta         = 1         # 0=FwdEuler, 1=BwdEuler, 0.5=CrankNicholson
}

Coupling {
    Tol           = 1e-10     # tolerance for the coupling (not always used)
    Iter          = 10        # max. number of iterations for the fixed-point iteration; -1 = till convergence
    Stab          = 1.0       # Laplace-Beltrami-stabilization
    Projection    = 0         # only thetascheme: 1 = Perform a projection step before FP (not implemented a.t.m.)
}

# re-initialization of levelset function
Reparam {
    Freq          = 10        # number of timesteps before reparametrize the level-set function
    Method        = 03        # method of reparametrize level-set function, see ReparamFactorCL for documentation
    MinGrad       = 0.1       # minimal allowed norm of the gradient of phi
    MaxGrad       = 10        # maximal allowed norm of the gradient of phi
    NarrowBand    = -1.0      # Narrow-Band method for the Euclidian method (e.g. 0.5 : all dof with <50% of the maximal level-set value are considered)
}

# adaptive refinement
AdaptRef {
    Freq          = 10        # adaptive refinement every n steps
    FinestLevel   = 3         # finest level in the near of the phase boundary
    CoarsestLevel = 0         # coarsest level in the near of the phase boundary
    Width         = 0.25e-3   # domain of refinement
    LoadBalStrategy= 1        # 0 - No Migration, 1 - Adaptive, 2 - Recursive
    Partitioner    = 1        # 1 - Metis, 2 - Zoltan, 3 - Scotch
}

# material data, all units are SI
Mat {
    DensDrop      = 845.442   # n-butanol - water
    ViscDrop      = 3.281e-3
    DensFluid     = 986.506
    ViscFluid     = 1.388e-3
    SmoothZone    = 1e-4
}

# experimental conditions
Exp {
    RadDrop       = 1.0e-3   1.0e-3   1.0e-3    # radii of the ellipsoidal droplet
    PosDrop       = 0    -6.2e-3   0            # position of the droplet
    Gravity       = 0    -9.81     0            # gravity force
    FlowDir       = 1                           # flow direction (x/y/z = 0/1/2)
    InflowVel     = -35e-3                      # max. inflow velocity (parabolic profile)
    RadInlet      = 3.6e-3                      # radius at inlet of measuring device, 3.5e-3 for old meas. cell
    InflowFreq    = 0                           # inflow frequence
    InflowAmpl    = 0                           # inflow amplitude
}

# surface tension
SurfTens {
    VarTension    = 0         # 0=off, 1=on
    SurfTension   = 1.63e-3   # surface tension coefficient
    JumpWidth     = 5e-4      # jump width
    RelPos        = 1.5       # position of the jump between upper edge (lambda=0) and barycenter (lambda=1)
    DirtFactor    = 0.8       # red. factor for surface tension (due to contamination) in lower droplet)
}

# mass transport
Transp {
    DoTransp      = 0         # 0=off, 1=on
    Theta         = 0.5       # time integration theta scheme
    Iter          = 200       # max. number of iterations
    Tol           = 1e-10     # stopping criterion
    DiffPos       = 5e-3      # diffusion coefficient (pos. part)
    DiffNeg       = 1e-2      # diffusion coefficient (neg. part)
    HPos          = 1         # Henry condition: Hneg * cneg = Hpos * cpos
    HNeg          = 0.5       # Henry condition: Hneg * cneg = Hpos * cpos
    IniCPos       = 0.1       # initial concentration (pos. part)
    IniCNeg       = 5         # initial concentration (neg. part)
    NitschePenalty  =  0      # Nitsche penalty term
    NitscheXFEMStab =  0.1    # threshold for discarding ext. dofs parameter, default 0.1
}

# surfactant transport
SurfTransp {
    DoTransp      = 0         # surfactant transport on (1) or off (0)
    Theta         = 0.5       # 0=FwdEuler, 1=BwdEuler, 0.5=CrankNicholson
    Iter          = 1000      # iterations of solver for surfactant equation
    Tol           = 1e-10     # tolerance of solver for surfactant equation
    OmitBound     = -1.       # omit dof with small mass on the interface, -1 = keeps all dof
    Visc          = 1e-5      # interfacial diffusion coefficient
}

# Ensight settings
Ensight {
    EnsightOut    = 0         # Ensight output
    EnsCase       = nsmzi     # name of Ensight case
    EnsDir        = ensight   # local directory for Ensight files
    Binary        = 0         # 1 = binary output, 0 = ascii output
    MasterOut     = 1         # only master writes out ensight files
    GeomName      = nsmzi     # name for the geometry
}

#VTK output
VTK{
    VTKOut        = 0         # VTK output
    VTKDir        = vtk       # local directory for vtk files
    VTKName       = nsmzi     # name of vtk files
    Binary        = 1         # write out VTK files in binary format
}

# Write out results, read in for restart
Restart {
    Serialization = 1              # perform serialization every n steps
    Overwrite     = 1              # overwrite old output-files or create new for every step
    Inputfile     = none     # reads multigrid from deserialization files, special value "none" to ignore
    Outputfile    = mg/data        # writes multigrid and numerical data to serialisation files
    Binary        = 0              # no effect
}

# domain, bnd/ini conditions
DomainCond {
    InitialCond   = 0                  # 0=zero, 1/2=flow with/without drop, -1=read from file (see Inputfile), -10=read from ensight file
    GeomType      = 0                   # specifies the used geometry (0=ReadMeshBuilder, 1=BrickBuilder)
    InitialFile   = start/data          # file prefix when reading data for initial condition
    MeshFile      = gambit/NMR_05.msh   # mesh file (created by GAMBIT, FLUENT/UNS format) or dimensions of a cuboid (e.g. 2x3x4\@5x6x7)
    BoundaryType  = 2!21!0             # Dir0BC= 0, DirBC= 2, Per1BC= 13, Per2BC= 11, Nat0BC= 21, NatBC= 23, NoBC= 98, UndefinedBC_= 99 
    BoundaryFncs  = InflowCell!ZeroVel!ZeroVel
}
