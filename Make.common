#########################################################
#   c o m m o n   r u l e s   for all local makefiles   #
#########################################################

DROPS_ROOT = ..


all: $(EXEC)
	$(MAKE) $(EXEC)
	@echo "--> Made all executables in $(DIR)!"

strip:
	for F in $(EXEC); do if [ -x $$F ]; then strip $$F; fi; done
	@echo "--> Stripped all executables in $(DIR)!"

clean:
	rm -f *.o $(DELETE)

distclean: clean
	rm -rf $(DISTDELETE)

dep:
	cd $(DROPS_ROOT) && $(MAKE) dep

doc:
	cd $(DROPS_ROOT) && $(MAKE) doc

# .cpp -> .o
../%.o: ../%.cpp
ifeq ($(CXX),mex)
	$(CXX) $(CXXFLAGS) -outdir ../$(*D) -c ../$*.cpp
else
	$(CXX) $(CXXFLAGS) -o ../$*.o -c ../$*.cpp
endif

# override implicit c++ rule
%.o: %.cpp

# local objectfiles get auto-prefix:
$(OBJ): %.o: ../$(DIR)/%.o

.PHONY: all clean distclean dep default doc


# include settings from the config file drops.conf:
include ../drops.conf

# include global dependencies
-include ../$(DEPFILE)

